{{- if .Values.gatewayConfig }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "common.names.fullname" . }}-gateway
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "common.labels.standard" . | nindent 4 }}
    app.kubernetes.io/component: "job-gateway"
    {{- if .Values.commonLabels }}
    {{- include "common.tplvalues.render" ( dict "value" .Values.commonLabels "context" $ ) | nindent 4 }}
    {{- end }}
data:
  application.yaml: |-
    app:
      code: {{ .Values.app.code }}
      secret: {{ .Values.app.secret }}
    esb:
      service:
        url: {{ .Values.esb.service.url }}
      public-key-base64: {{ .Values.esb.publicKeyBase64 }}
    job:
      gateway:
        server:
          port: {{ .Values.gatewayConfig.containerPort.https }}
          http:
            enabled: true
            port: {{ .Values.gatewayConfig.containerPort.http }}
          ssl:
            keystore:
              type: PKCS12
              path: "file:/data/job/cert/job_server.p12"
              password: ${keystore.password}
            key:
              alias: job_server.p12
            truststore:
              path: file:/data/job/cert/job_server.truststore
              password: ${truststore.password}
      security:
        private-key-base64: {{ .Values.job.security.privateKeyBase64 }}
        public-key-base64: {{ .Values.job.security.publicKeyBase64 }}
        actuator:
          user:
            name: {{ .Values.job.security.actuator.user.name }}
            password: {{ .Values.job.security.actuator.user.password }}
      acturtor:
        management:
          server:
            port: {{ .Values.gatewayConfig.containerPort.management }}
      web:
        url: {{ printf "%s://%s" .Values.frontendConfig.web.scheme .Values.frontendConfig.web.domain }}
{{- end}}
